FROM node:11-alpine

WORKDIR /usr/src/bgw-backend

COPY package*.json ./
RUN npm ci

COPY . .
ARG TEST_LEHRER_CREDS=local
ENV TEST_LEHRER_CREDS ${TEST_LEHRER_CREDS}
ARG TEST_LEHRER_P=local
ENV TEST_LEHRER_P ${TEST_LEHRER_P}
ARG TEST_LEHRER_U=local
ENV TEST_LEHRER_U ${TEST_LEHRER_U}
ARG TEST_SCH_CREDS=local
ENV TEST_SCH_CREDS ${TEST_SCH_CREDS}
ARG TEST_SCH_P=local
ENV TEST_SCH_P ${TEST_SCH_P}
ARG TEST_SCH_U=local
ENV TEST_SCH_U ${TEST_SCH_U}

RUN npm run test

EXPOSE 59091
CMD [ "npm", "start" ]
