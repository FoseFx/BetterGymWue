$(document).ready(function(){$("#leftarrow").css("opacity","0");var c=false;document.cookie.split(";").forEach(function(a){if(a=="a=true"){c=true}});stopSpinner();if(!c){showAGB()}if(c){checkLoginCookie()}var b=checkCookie("key");if(b!==null){Gkey=b}var g=JSON.parse(checkCookie("tt"));if(g!==null){GTimeTable=g}var f=checkCookie("kl");if(f!==null){var d="";for(var e=0;e<f;e++){d=d+checkCookie("k"+e)}GMyKurse=JSON.parse(d).a}});function splitter(d,a){var c=[];while(d.length>a){var e=d.substring(0,a).lastIndexOf(" ");e=e<=0?a:e;c.push(d.substring(0,e));var b=d.indexOf(" ",e)+1;if(b<e||b>e+a){b=e}d=d.substring(b)}c.push(d);return c}function stopSpinner(){$("#spinner").css("opacity","0");setTimeout(function(){$("#spinner").css("display","none");$("#page-wraper").css("display","block");setTimeout(function(){$("#page-wraper").css("opacity","1")},10)},200)}function startSpinner(){$("#page-wraper").css("opacity","0");setTimeout(function(){$("#page-wraper").css("display","none");$("#spinner").css("display","flex");setTimeout(function(){$("#spinner").css("opacity","1")},10)},200)}function showAGB(){$("#terms").css("display","flex")}function checkLoginCookie(){var a=checkCookie("key");if(a!==null){login(a,1)}else{moveInLogin()}}function checkStufeCookie(){startSpinner();var a=checkCookie("stufe");if(a!==null){Gstufe=a;GStufeid=checkCookie("stufeid");accessStufe()}else{moveInStufe();getStufen()}stopSpinner();$(".nointeract").removeClass("nointeract")}function moveInLogin(){setTimeout(function(){$("#login-wrapper").css("transform","translate(-50%,-50%)")},700)}function unAuth(){$("#login-wrapper").css("box-shadow","0px 0px 12px 0px rgba(255,36,36,1)");$("#page-wraper").addClass("shake shake-constant");setTimeout(function(){$("#page-wraper").removeClass("shake shake-constant");$("#psw").val("")},200)}function moveInStufe(){$("#stufe-wrapper").removeClass("hidden").css("transform","translate(-50%, -50%)")}function Auth(a){document.cookie="key="+a+";expires=Fri, 31 Dec 9999 23:59:59 GMT";Gkey=a;$("#login-wrapper").css("opacity","0");setTimeout(function(){$("#login-wrapper").css("display","none");checkStufeCookie()},500)}function checkCookie(b){var a=null;document.cookie.split(";").forEach(function(d){var c=d.split("=");if(c[0].replace(/\s/g,"")===b){a=c[1]}});return a}function moveOutStufe(){$("#stufe-wrapper").css("transform","translate(-1000%, -50%)");setTimeout(function(){$("#login-wrapper").hide()},500)}function getWeekOfYear(a){return(a.getWeek())}Date.prototype.getWeek=function(){var a=new Date(this.valueOf());var b=(this.getDay()+6)%7;a.setDate(a.getDate()-b+3);var c=a.valueOf();a.setMonth(0,1);if(a.getDay()!=4){a.setMonth(0,1+((4-a.getDay())+7)%7)}return 1+Math.ceil((c-a)/604800000)};function to5erString(b){var a=b;while(a.length!==5){a="0"+a}return a}var Scrawled=0;var Scbase=GURL+"Schueler/";var Scmid="f1/";var Scurl="subst_001.htm";var Scfiles=[];var Scbodys=[];var Scbody1=null;var Scbody2=null;var allowed=true;function scrawl(){if(!allowed){return}allowed=false;startSpinner();var a=Scbase+Scmid+Scurl;$.ajax({cache:false,contentType:"Content-type: text/html; charset=iso-8859-1",url:a,beforeSend:function(b){b.setRequestHeader("Authorization","Basic "+Gkey);b.overrideMimeType("text/html;charset=iso-8859-1")},success:function(b){Scfiles.push(Scurl);Scurl=b.split('<meta http-equiv="refresh" content="10; URL=')[1].split('">')[0];Scbodys.push(b.split('<body bgcolor="#F0F0F0">')[1].split("</body>")[0]);b=null;allowed=true;if(Scfiles.indexOf(Scurl)===-1){scrawl()}else{evaScrawl()}}})}function evaScrawl(){Scrawled++;if(Scrawled===1){Scbody1=Scbodys;Scmid="f2/";Scurl="subst_001.htm";Scfiles=[];Scbodys=[];scrawl()}if(Scrawled!==2){return}Scbody2=Scbodys;var b=[];var a=[];Scbody1.forEach(function(h){h=$(h);var f=h.find("td.info");if(f.length===0){f=null}if(f!==null){var e=[];f.each(function(){e.push($(this).html())});e.forEach(function(g){if(b.indexOf(g)===-1){b.push(g)}})}var d=[];$(h.find("table.mon_list")[0]).children("tbody").children().each(function(j){if(j===0){return}if($(this).children().length===1){d.push({klasse:$(this).children(".inline_header").html(),ctnd:[]})}else{var k=$(this).children();var g=[,$(k[1]).html()];if(g[1].indexOf(" - ")!==-1){g=g[1].split(" - ");d[d.length-1].ctnd.push({date:$(k[0]).html(),stunde:g[0],kurs:$(k[2]).html(),type:$(k[3]).children("b").html(),nraum:$(k[5]).html(),info:$(k[6]).html()})}d[d.length-1].ctnd.push({date:$(k[0]).html(),stunde:g[1],kurs:$(k[2]).html(),type:$(k[3]).children("b").html(),nraum:$(k[5]).html(),info:$(k[6]).html()})}});d.forEach(function(g){var i=false;a.forEach(function(j){if(j.klasse===g.klasse){i=true;g.ctnd.forEach(function(k){j.ctnd.push(k)})}});if(!i){a.push(g)}})});b=[[],b];a=[[],a];Scbody2.forEach(function(h){h=$(h);var f=h.find("td.info");if(f.length===0){f=null}if(f!==null){var e=[];f.each(function(){e.push($(this).html())});e.forEach(function(g){if(b[0].indexOf(g)===-1){b[0].push(g)}})}var d=[];$(h.find("table.mon_list")[0]).children("tbody").children().each(function(j){if(j===0){return}if($(this).children().length===1){d.push({klasse:$(this).children(".inline_header").html(),ctnd:[]})}else{var k=$(this).children();var g=[,$(k[1]).html()];if(g[1].indexOf(" - ")!==-1){g=g[1].split(" - ");d[d.length-1].ctnd.push({date:$(k[0]).html(),stunde:g[0],kurs:$(k[2]).html(),type:$(k[3]).children("b").html(),nraum:$(k[5]).html(),info:$(k[6]).html()})}d[d.length-1].ctnd.push({date:$(k[0]).html(),stunde:g[1],kurs:$(k[2]).html(),type:$(k[3]).children("b").html(),nraum:$(k[5]).html(),info:$(k[6]).html()})}});d.forEach(function(g){var i=false;a[0].forEach(function(j){if(j.klasse===g.klasse){i=true;g.ctnd.forEach(function(k){j.ctnd.push(k)})}});if(!i){a[0].push(g)}})});a.reverse();b.reverse();console.log(a);console.log(b);stopSpinner();var c;a.forEach(function(g,f){var e=new Date();var h=["So","Mo","Di","Mi","Do","Fr","Sa"];if(f===1){e.setDate(e.getDate()+1)}while(e.getDay()===0||e.getDay()===6){e.setDate(e.getDate()+1)}if(f===0){c=e}if(f===1&&c.getDate()==e.getDate()){e.setDate(e.getDate()+1)}var i=e.getDate()+"."+(e.getMonth()+1)+".";console.log(i);allThatComplicatedStuff(h,e,i,a,b)});$("#anzeigen-wrapper").removeClass("hidden")}function allThatComplicatedStuff(m,g,k,h,n){var l='<div class="tag">\n                    <h1>'+m[g.getDay()]+" "+k+"</h1>\n                    <hr>\n                    <table>\n                        <tbody class='lul'>\n                            <tr><td><b>Std.</b></td><td><b>Fach</b></td><td><b>Raum</b></td><td><b>Lehrer</b></td></td><td></td></tr>\n                        </tbody>\n                    </table>\n                </div>";var j=$(l);var i=$(j).find("tbody.lul")[0];var c=(g.getWeek()%2===0)?0:1;var f=[];h.forEach(function(d){d.forEach(function(o){if(o.klasse.indexOf(Gstufe)===-1){return}o.ctnd.forEach(function(p){if(p.date!==k){return}GMyKurse.forEach(function(q){if(q.fach===p.kurs||p.kurs==="&nbsp;"){f.push(p)}});GTimeTable[c].days.forEach(function(q){q.forEach(function(r){if(r==={}){return}if(r===null){return}if(r.type!=="klasse"){return}if(r.fach===p.kurs){f.push(p)}})})})})});console.log(f);var a=GTimeTable[c].days[g.getDay()-1];a.forEach(function(q,o){var p="";if(q==={}){p="<tr><td colspan='5'>Pause</td></tr>"}else{if(q.type==="klasse"){p="<tr><td class='stundeLUL'>"+(o+1)+"</td><td class='fachLUL'>"+q.fach+"</td><td class='raumLUL'>"+q.raum+"</td><td class='lehrerLUL'>"+q.lehrer+"</td></tr>"}else{if(q.type==="kurs"){GMyKurse.forEach(function(r){if(r.title!==q.fach){return}var s=null;q.raeume.forEach(function(t){if(t.kurs===r.fach){s=t.raum}});s=(s===null)?"- - -":s;p="<tr><td class='stundeLUL'>"+(o+1)+"</td><td class='fachLUL'>"+r.fach+"</td><td class='raumLUL'>"+s+"</td><td class='lehrerLUL'>"+r.lehrer+"</td></tr>"})}}}var d=$(p);h.forEach(function(r){if(typeof p==="undefined"){return}if(r.length===0){return}if(r[0].ctnd[0].date!==k){return}r.forEach(function(s){if(s.klasse.indexOf(Gstufe)===-1){return}s.ctnd.forEach(function(x){var u=x.type;var t=x.stunde;var v=d.find(".stundeLUL").html();var y=x.kurs.toLowerCase();var w=d.find(".fachLUL").html();w=(typeof w!=="undefined")?w.toLowerCase():w;var z="";if(u=="Vertretung"){z="blue"}else{if(u=="Entfall"){z="red"}else{z="green"}}if(t==v&&y==w){d.find(".raumLUL").html(x.nraum);d.css("color",z)}})})});p=d.wrap("<p/>").parent().html();if(typeof p==="undefined"){return}p=p.replace("undefined","?");p=p.replace("null","");$(i).append(p)});var b=$("<h3>Info</h3>\n<table class='hi'>\n    <tbody class=\"headerTab\">\n        \n    </tbody>\n</table>");n.forEach(function(o,d){if(h[d][0].ctnd[0].date!==k){return}if(o===[]||o[0]===undefined){return}if(o[1]!==undefined){b.find(".headerTab").append("<tr><td>"+o[0]+"</td><td>"+o[1]+"</td></tr>")}else{b.find(".headerTab").append("<tr><td>"+o[0]+"</td></tr>")}});Schulplaner.forEach(function(d){if(d.tag!=k){return}if(Gstufe.indexOf(d.stufe)!=-1||d.stufe=="*"){b.find("tbody").append("<tr><td><i style='background: yellow'>"+((d.stufe=="*")?"":d.stufe)+d.wert.replace("\n","<br>")+"</i></td></tr>")}});if($(b).find("tbody").children().length!==0){j.append($(b))}var e=$("<h3>"+Gstufe+"</h3>\n<table class='hi'>\n   <tbody>\n       \n   </tbody>\n</table>");console.log(h);h.forEach(function(o,d){o.forEach(function(p,q){if(p.klasse.indexOf(Gstufe)!==-1){p.ctnd.forEach(function(s){var r=s.type;if(r==="Vertretung"){r="Vert"}if(r==="Raum-Vtr."){r="Raum"}if(r==="Entfall"){r="Entf"}if(r==="Sondereins."){r="Sonder"}var u=s.info;var v=[["selbständiges arbeiten","Selbst. Arb."],["selbstständiges arbeiten","Selbst. Arb."],["aufgaben","Aufg."],["raumwechsel","RaumW."]];v.forEach(function(w){u=u.replace(new RegExp(w[0],"ig"),w[1])});var t="<tr><td><b>"+s.stunde+"</b></td><td>"+s.kurs+"</td><td>"+r+"</td><td>"+s.nraum+"</td><td>"+u+"</td></tr>";if(s.date===k){e.find("tbody").append(t)}})}})});if(e.find("tbody").children().length!==0){j.append(e)}j.append("<div class='spacer'></div>");$("#inner-tag-wrapper").append(j)};