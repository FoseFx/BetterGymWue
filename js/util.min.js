$(document).ready(function(){$("#leftarrow").css("opacity","0");var c=false;document.cookie.split(";").forEach(function(a){if(a=="a=true"){c=true}});stopSpinner();if(!c){showAGB()}if(c){checkLoginCookie()}var b=checkCookie("key");if(b!==null){Gkey=b}var g=JSON.parse(checkCookie("tt"));if(g!==null){GTimeTable=g}var f=checkCookie("kl");if(f!==null){var d="";for(var e=0;e<f;e++){d=d+checkCookie("k"+e)}GMyKurse=JSON.parse(d).a}});function splitter(d,a){var c=[];while(d.length>a){var e=d.substring(0,a).lastIndexOf(" ");e=e<=0?a:e;c.push(d.substring(0,e));var b=d.indexOf(" ",e)+1;if(b<e||b>e+a){b=e}d=d.substring(b)}c.push(d);return c}function stopSpinner(){$("#spinner").css("opacity","0");setTimeout(function(){$("#spinner").css("display","none");$("#page-wraper").css("display","block");setTimeout(function(){$("#page-wraper").css("opacity","1")},10)},200)}function startSpinner(){$("#page-wraper").css("opacity","0");setTimeout(function(){$("#page-wraper").css("display","none");$("#spinner").css("display","flex");setTimeout(function(){$("#spinner").css("opacity","1")},10)},200)}function showAGB(){$("#terms").css("display","flex")}function checkLoginCookie(){var a=checkCookie("key");if(a!==null){login(a,1)}else{moveInLogin()}}function checkStufeCookie(){startSpinner();var a=checkCookie("stufe");if(a!==null){Gstufe=a;GStufeid=checkCookie("stufeid");accessStufe()}else{moveInStufe();getStufen()}stopSpinner();$(".nointeract").removeClass("nointeract")}function moveInLogin(){setTimeout(function(){$("#login-wrapper").css("transform","translate(-50%,-50%)")},700)}function unAuth(){$("#login-wrapper").css("box-shadow","0px 0px 12px 0px rgba(255,36,36,1)");$("#page-wraper").addClass("shake shake-constant");setTimeout(function(){$("#page-wraper").removeClass("shake shake-constant");$("#psw").val("")},200)}function moveInStufe(){$("#stufe-wrapper").removeClass("hidden").css("transform","translate(-50%, -50%)")}function Auth(a){document.cookie="key="+a+";expires=Fri, 31 Dec 9999 23:59:59 GMT";Gkey=a;$("#login-wrapper").css("opacity","0");setTimeout(function(){$("#login-wrapper").css("display","none");checkStufeCookie()},500)}function checkCookie(b){var a=null;document.cookie.split(";").forEach(function(d){var c=d.split("=");if(c[0].replace(/\s/g,"")===b){a=c[1]}});return a}function moveOutStufe(){$("#stufe-wrapper").css("transform","translate(-1000%, -50%)");setTimeout(function(){$("#login-wrapper").hide()},500)}function getWeekOfYear(a){return(a.getWeek())}Date.prototype.getWeek=function(){var a=new Date(this.valueOf());var b=(this.getDay()+6)%7;a.setDate(a.getDate()-b+3);var c=a.valueOf();a.setMonth(0,1);if(a.getDay()!=4){a.setMonth(0,1+((4-a.getDay())+7)%7)}return 1+Math.ceil((c-a)/604800000)};function to5erString(b){var a=b;while(a.length!==5){a="0"+a}return a}var Scrawled=0;var Scbase=GURL+"Schueler/";var Scmid="f1/";var Scurl="subst_001.htm";var Scfiles=[];var Scbodys=[];var Scbody1=null;var Scbody2=null;var allowed=true;function scrawl(){if(!allowed){return}allowed=false;startSpinner();var a=Scbase+Scmid+Scurl;$.ajax({cache:false,contentType:"Content-type: text/html; charset=iso-8859-1",url:a,beforeSend:function(b){b.setRequestHeader("Authorization","Basic "+Gkey);b.overrideMimeType("text/html;charset=iso-8859-1")},success:function(b){Scfiles.push(Scurl);Scurl=b.split('<meta http-equiv="refresh" content="10; URL=')[1].split('">')[0];Scbodys.push(b.split('<body bgcolor="#F0F0F0">')[1].split("</body>")[0]);b=null;allowed=true;if(Scfiles.indexOf(Scurl)===-1){scrawl()}else{evaScrawl()}}})}function evaScrawl(){Scrawled++;if(Scrawled===1){Scbody1=Scbodys;Scmid="f2/";Scurl="subst_001.htm";Scfiles=[];Scbodys=[];scrawl()}if(Scrawled!==2){return}Scbody2=Scbodys;var b=[];var a=[];Scbody1.forEach(function(h){h=$(h);var f=h.find("td.info");if(f.length===0){f=null}if(f!==null){var e=[];f.each(function(){e.push($(this).html())});e.forEach(function(g){if(b.indexOf(g)===-1){b.push(g)}})}var d=[];$(h.find("table.mon_list")[0]).children("tbody").children().each(function(j){if(j===0){return}if($(this).children().length===1){d.push({klasse:$(this).children(".inline_header").html(),ctnd:[]})}else{var k=$(this).children();var g=[,$(k[1]).html()];if(g[1].indexOf(" - ")!==-1){g=g[1].split(" - ");d[d.length-1].ctnd.push({date:$(k[0]).html(),stunde:g[0],kurs:$(k[2]).html(),type:$(k[3]).children("b").html(),nraum:$(k[5]).html(),info:$(k[6]).html()})}d[d.length-1].ctnd.push({date:$(k[0]).html(),stunde:g[1],kurs:$(k[2]).html(),type:$(k[3]).children("b").html(),nraum:$(k[5]).html(),info:$(k[6]).html()})}});d.forEach(function(g){var i=false;a.forEach(function(j){if(j.klasse===g.klasse){i=true;g.ctnd.forEach(function(k){j.ctnd.push(k)})}});if(!i){a.push(g)}})});b=[[],b];a=[[],a];Scbody2.forEach(function(h){h=$(h);var f=h.find("td.info");if(f.length===0){f=null}if(f!==null){var e=[];f.each(function(){e.push($(this).html())});e.forEach(function(g){if(b[0].indexOf(g)===-1){b[0].push(g)}})}var d=[];$(h.find("table.mon_list")[0]).children("tbody").children().each(function(j){if(j===0){return}if($(this).children().length===1){d.push({klasse:$(this).children(".inline_header").html(),ctnd:[]})}else{var k=$(this).children();var g=[,$(k[1]).html()];if(g[1].indexOf(" - ")!==-1){g=g[1].split(" - ");d[d.length-1].ctnd.push({date:$(k[0]).html(),stunde:g[0],kurs:$(k[2]).html(),type:$(k[3]).children("b").html(),nraum:$(k[5]).html(),info:$(k[6]).html()})}d[d.length-1].ctnd.push({date:$(k[0]).html(),stunde:g[1],kurs:$(k[2]).html(),type:$(k[3]).children("b").html(),nraum:$(k[5]).html(),info:$(k[6]).html()})}});d.forEach(function(g){var i=false;a[0].forEach(function(j){if(j.klasse===g.klasse){i=true;g.ctnd.forEach(function(k){j.ctnd.push(k)})}});if(!i){a[0].push(g)}})});a.reverse();b.reverse();console.log(a);console.log(b);stopSpinner();var c;a.forEach(function(q,n){var j=new Date();var p=["So","Mo","Di","Mi","Do","Fr","Sa"];if(n===1){j.setDate(j.getDate()+1)}while(j.getDay()===0||j.getDay()===6){j.setDate(j.getDate()+1)}if(n===0){c=j}if(n===1&&c.getDate()==j.getDate()){j.setDate(j.getDate()+1)}var m=j.getDate()+"."+(j.getMonth()+1)+".";console.log(j);var o='<div class="tag">\n                    <h1>'+p[j.getDay()]+" "+m+"</h1>\n                    <hr>\n                    <table>\n                        <tbody class='lul'>\n                            <tr><td><b>Std.</b></td><td><b>Fach</b></td><td><b>Raum</b></td><td><b>Lehrer</b></td></td><td></td></tr>\n                        </tbody>\n                    </table>\n                </div>";var l=$(o);var k=$(l).find("tbody.lul")[0];var g=(j.getWeek()%2===0)?0:1;var i=[];a.forEach(function(d){d.forEach(function(r){if(r.klasse.indexOf(Gstufe)===-1){return}r.ctnd.forEach(function(s){if(s.date!==m){return}GMyKurse.forEach(function(t){if(t.fach===s.kurs||s.kurs==="&nbsp;"){i.push(s)}});GTimeTable[g].days.forEach(function(t){t.forEach(function(u){if(u==={}){return}if(u===null){return}if(u.type!=="klasse"){return}if(u.fach===s.kurs){i.push(s)}})})})})});console.log(i);var e=GTimeTable[g].days[j.getDay()-1];e.forEach(function(u,r){var t="";if(u==={}){t="<tr><td colspan='5'>Pause</td></tr>"}else{if(u.type==="klasse"){t="<tr><td class='stundeLUL'>"+(r+1)+"</td><td class='fachLUL'>"+u.fach+"</td><td class='raumLUL'>"+u.raum+"</td><td class='lehrerLUL'>"+u.lehrer+"</td></tr>"}else{if(u.type==="kurs"){GMyKurse.forEach(function(s){if(s.title!==u.fach){return}var v=null;u.raeume.forEach(function(w){if(w.kurs===s.fach){v=w.raum}});v=(v===null)?"- - -":v;t="<tr><td class='stundeLUL'>"+(r+1)+"</td><td class='fachLUL'>"+s.fach+"</td><td class='raumLUL'>"+v+"</td><td class='lehrerLUL'>"+s.lehrer+"</td></tr>"})}}}var d=$(t);a.forEach(function(s){if(typeof t==="undefined"){return}if(s.length===0){return}if(s[0].ctnd[0].date!==m){return}s.forEach(function(v){if(v.klasse.indexOf(Gstufe)===-1){return}v.ctnd.forEach(function(A){var x=A.type;var w=A.stunde;var y=d.find(".stundeLUL").html();var B=A.kurs.toLowerCase();var z=d.find(".fachLUL").html();z=(typeof z!=="undefined")?z.toLowerCase():z;var C="";if(x=="Vertretung"){C="blue"}else{if(x=="Entfall"){C="red"}else{C="green"}}if(w==y&&B==z){d.find(".raumLUL").html(A.nraum);d.css("color",C)}})})});t=d.wrap("<p/>").parent().html();if(typeof t==="undefined"){return}t=t.replace("undefined","?");t=t.replace("null","");$(k).append(t)});var f=$("<h3>Info</h3>\n<table class='hi'>\n    <tbody class=\"headerTab\">\n        \n    </tbody>\n</table>");b.forEach(function(r,d){if(a[d][0].ctnd[0].date!==m){return}if(r===[]||r[0]===undefined){return}if(r[1]!==undefined){f.find(".headerTab").append("<tr><td>"+r[0]+"</td><td>"+r[1]+"</td></tr>")}else{f.find(".headerTab").append("<tr><td>"+r[0]+"</td></tr>")}});if($(f).find("tbody").children().length!==0){l.append($(f))}var h=$("<h3>"+Gstufe+"</h3>\n<table class='hi'>\n   <tbody>\n       \n   </tbody>\n</table>");console.log(a);a.forEach(function(r,d){r.forEach(function(s,t){if(s.klasse.indexOf(Gstufe)!==-1){s.ctnd.forEach(function(v){var u=v.type;if(u==="Vertretung"){u="Vert"}if(u==="Raum-Vtr."){u="Raum"}if(u==="Entfall"){u="Entf"}if(u==="Sondereins."){u="Sonder"}var x=v.info;var y=[["selbständiges arbeiten","Selbst. Arb."],["selbstständiges arbeiten","Selbst. Arb."],["aufgaben","Aufg."],["raumwechsel","RaumW."]];y.forEach(function(z){x=x.replace(new RegExp(z[0],"ig"),z[1])});var w="<tr><td><b>"+v.stunde+"</b></td><td>"+v.kurs+"</td><td>"+u+"</td><td>"+v.nraum+"</td><td>"+x+"</td></tr>";if(v.date===m){h.find("tbody").append(w)}})}})});if(h.find("tbody").children().length!==0){l.append(h)}l.append("<div class='spacer'></div>");$("#inner-tag-wrapper").append(l)});$("#anzeigen-wrapper").removeClass("hidden")};