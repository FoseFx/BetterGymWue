$(document).ready(function(){$("#leftarrow").css("opacity","0");var a=false;document.cookie.split(";").forEach(function(t){if(t=="a=true")a=true});stopSpinner();if(!a)showAGB();if(a)checkLoginCookie();var l=checkCookie("key");if(l!==null)Gkey=l;var ptt=JSON.parse(checkCookie("tt"));if(ptt!==null){GTimeTable=ptt}var kl=checkCookie("kl");if(kl!==null){var k="";for(var i=0;i<kl;i++)k=k+checkCookie("k"+i);GMyKurse=JSON.parse(k).a}});function splitter(str,l){var strs=[];while(str.length>l){var pos=str.substring(0,l).lastIndexOf(" ");pos=pos<=0?l:pos;strs.push(str.substring(0,pos));var i=str.indexOf(" ",pos)+1;if(i<pos||i>pos+l)i=pos;str=str.substring(i)}strs.push(str);return strs}function stopSpinner(){$("#spinner").css("opacity","0");setTimeout(function(){$("#spinner").css("display","none");$("#page-wraper").css("display","block");setTimeout(function(){$("#page-wraper").css("opacity","1")},10)},200)}function startSpinner(){$("#page-wraper").css("opacity","0");setTimeout(function(){$("#page-wraper").css("display","none");$("#spinner").css("display","flex");setTimeout(function(){$("#spinner").css("opacity","1")},10)},200)}function showAGB(){$("#terms").css("display","flex")}function checkLoginCookie(){var c=checkCookie("key");if(c!==null)login(c,1);else moveInLogin()}function checkStufeCookie(){startSpinner();var r=checkCookie("stufe");if(r!==null){Gstufe=r;GStufeid=checkCookie("stufeid");accessStufe()}else{moveInStufe();getStufen()}stopSpinner();$(".nointeract").removeClass("nointeract")}function moveInLogin(){setTimeout(function(){$("#login-wrapper").css("transform","translate(-50%,-50%)")},700)}function unAuth(){$("#login-wrapper").css("box-shadow","0px 0px 12px 0px rgba(255,36,36,1)");$("#page-wraper").addClass("shake shake-constant");setTimeout(function(){$("#page-wraper").removeClass("shake shake-constant");$("#psw").val("")},200)}function moveInStufe(){$("#stufe-wrapper").removeClass("hidden").css("transform","translate(-50%, -50%)")}function Auth(key){document.cookie="key="+key+";expires=Fri, 31 Dec 9999 23:59:59 GMT";Gkey=key;$("#login-wrapper").css("opacity","0");setTimeout(function(){$("#login-wrapper").css("display","none");checkStufeCookie()},500)}function checkCookie(c){var r=null;document.cookie.split(";").forEach(function(t){var l=t.split("=");if(l[0].replace(/\s/g,"")===c)r=l[1]});return r}function moveOutStufe(){$("#stufe-wrapper").css("transform","translate(-1000%, -50%)");setTimeout(function(){$("#login-wrapper").hide()},500)}function getWeekOfYear(d){return d.getWeek()}Date.prototype.getWeek=function(){var target=new Date(this.valueOf());var dayNr=(this.getDay()+6)%7;target.setDate(target.getDate()-dayNr+3);var firstThursday=target.valueOf();target.setMonth(0,1);if(target.getDay()!=4){target.setMonth(0,1+(4-target.getDay()+7)%7)}return 1+Math.ceil((firstThursday-target)/6048e5)};function to5erString(i){var l=i;while(l.length!==5){l="0"+l}return l}var Scrawled=0;var Scbase=GURL+"Schueler/";var Scmid="f1/";var Scurl="subst_001.htm";var Scfiles=[];var Scbodys=[];var Scbody1=null;var Scbody2=null;var allowed=true;function scrawl(){if(!allowed)return;allowed=false;startSpinner();var theurl=Scbase+Scmid+Scurl;$.ajax({cache:false,contentType:"Content-type: text/html; charset=iso-8859-1",url:theurl,beforeSend:function(xhr){xhr.setRequestHeader("Authorization","Basic "+Gkey);xhr.overrideMimeType("text/html;charset=iso-8859-1")},success:function(c){Scfiles.push(Scurl);Scurl=c.split('<meta http-equiv="refresh" content="10; URL=')[1].split('">')[0];Scbodys.push(c.split('<body bgcolor="#F0F0F0">')[1].split("</body>")[0]);c=null;allowed=true;if(Scfiles.indexOf(Scurl)===-1)scrawl();else evaScrawl()}})}function evaScrawl(){Scrawled++;if(Scrawled===1){Scbody1=Scbodys;Scmid="f2/";Scurl="subst_001.htm";Scfiles=[];Scbodys=[];scrawl()}if(Scrawled!==2)return;Scbody2=Scbodys;var cInfo=[];var cVertretung=[];Scbody1.forEach(function(seite){seite=$(seite);var info=seite.find("td.info");if(info.length===0)info=null;if(info!==null){var g=[];info.each(function(){g.push($(this).html())});g.forEach(function(t){if(cInfo.indexOf(t)===-1)cInfo.push(t)})}var table=[];$(seite.find("table.mon_list")[0]).children("tbody").children().each(function(i){if(i===0)return;if($(this).children().length===1)table.push({klasse:$(this).children(".inline_header").html(),ctnd:[]});else{var ch=$(this).children();var st=[,$(ch[1]).html()];if(st[1].indexOf(" - ")!==-1){st=st[1].split(" - ");table[table.length-1].ctnd.push({date:$(ch[0]).html(),stunde:st[0],kurs:$(ch[2]).html(),type:$(ch[3]).children("b").html(),nraum:$(ch[5]).html(),info:$(ch[6]).html()})}table[table.length-1].ctnd.push({date:$(ch[0]).html(),stunde:st[1],kurs:$(ch[2]).html(),type:$(ch[3]).children("b").html(),nraum:$(ch[5]).html(),info:$(ch[6]).html()})}});table.forEach(function(t){var set=false;cVertretung.forEach(function(t2){if(t2.klasse===t.klasse){set=true;t.ctnd.forEach(function(t3){t2.ctnd.push(t3)})}});if(!set)cVertretung.push(t)})});cInfo=[[],cInfo];cVertretung=[[],cVertretung];Scbody2.forEach(function(seite){seite=$(seite);var info=seite.find("td.info");if(info.length===0)info=null;if(info!==null){var g=[];info.each(function(){g.push($(this).html())});g.forEach(function(t){if(cInfo[0].indexOf(t)===-1)cInfo[0].push(t)})}var table=[];$(seite.find("table.mon_list")[0]).children("tbody").children().each(function(i){if(i===0)return;if($(this).children().length===1)table.push({klasse:$(this).children(".inline_header").html(),ctnd:[]});else{var ch=$(this).children();var st=[,$(ch[1]).html()];if(st[1].indexOf(" - ")!==-1){st=st[1].split(" - ");table[table.length-1].ctnd.push({date:$(ch[0]).html(),stunde:st[0],kurs:$(ch[2]).html(),type:$(ch[3]).children("b").html(),nraum:$(ch[5]).html(),info:$(ch[6]).html()})}table[table.length-1].ctnd.push({date:$(ch[0]).html(),stunde:st[1],kurs:$(ch[2]).html(),type:$(ch[3]).children("b").html(),nraum:$(ch[5]).html(),info:$(ch[6]).html()})}});table.forEach(function(t){var set=false;cVertretung[0].forEach(function(t2){if(t2.klasse===t.klasse){set=true;t.ctnd.forEach(function(t3){t2.ctnd.push(t3)})}});if(!set)cVertretung[0].push(t)})});cVertretung.reverse();cInfo.reverse();console.log(cVertretung);console.log(cInfo);stopSpinner();var date1;cVertretung.forEach(function(t,woche){var date=new Date;var tagesNamen=["So","Mo","Di","Mi","Do","Fr","Sa"];if(woche===1)date.setDate(date.getDate()+1);while(date.getDay()===0||date.getDay()===6)date.setDate(date.getDate()+1);if(woche===0)date1=date;if(woche===1&&date1.getDate()==date.getDate())date.setDate(date.getDate()+1);var d=date.getDate()+"."+(date.getMonth()+1)+".";console.log(date);var str='<div class="tag">\n'+"                    <h1>"+tagesNamen[date.getDay()]+" "+d+"</h1>\n"+"                    <hr>\n"+"                    <table>\n"+"                        <tbody class='lul'>\n"+"                            <tr><td><b>Std.</b></td><td><b>Fach</b></td><td><b>Raum</b></td><td><b>Lehrer</b></td></td><td></td></tr>\n"+"                        </tbody>\n"+"                    </table>\n"+"                </div>";var ret=$(str);var obj=$(ret).find("tbody.lul")[0];var week=date.getWeek()%2===0?0:1;var important=[];cVertretung.forEach(function(tag){tag.forEach(function(header){if(header.klasse.indexOf(Gstufe)===-1)return;header.ctnd.forEach(function(ctnd){if(ctnd.date!==d)return;GMyKurse.forEach(function(t2){if(t2.fach===ctnd.kurs||ctnd.kurs==="&nbsp;")important.push(ctnd)});GTimeTable[week].days.forEach(function(t2){t2.forEach(function(t3){if(t3==={})return;if(t3===null)return;if(t3.type!=="klasse")return;if(t3.fach===ctnd.kurs)important.push(ctnd)})})})})});console.log(important);var ttobj=GTimeTable[week].days[date.getDay()-1];ttobj.forEach(function(t2,i){var s="";if(t2==={})s="<tr><td colspan='5'>Pause</td></tr>";else if(t2.type==="klasse"){s="<tr><td class='stundeLUL'>"+(i+1)+"</td><td class='fachLUL'>"+t2.fach+"</td><td class='raumLUL'>"+t2.raum+"</td><td class='lehrerLUL'>"+t2.lehrer+"</td></tr>"}else if(t2.type==="kurs"){GMyKurse.forEach(function(t3){if(t3.title!==t2.fach)return;var raum=null;t2.raeume.forEach(function(value){if(value.kurs===t3.fach)raum=value.raum});raum=raum===null?"- - -":raum;s="<tr><td class='stundeLUL'>"+(i+1)+"</td><td class='fachLUL'>"+t3.fach+"</td><td class='raumLUL'>"+raum+"</td><td class='lehrerLUL'>"+t3.lehrer+"</td></tr>"})}var $s=$(s);cVertretung.forEach(function(cVvalue){if(typeof s==="undefined")return;if(cVvalue.length===0)return;if(cVvalue[0].ctnd[0].date!==d)return;cVvalue.forEach(function(value2){if(value2.klasse.indexOf(Gstufe)===-1)return;value2.ctnd.forEach(function(value){var tsie=value.type;var vst=value.stunde;var sst=$s.find(".stundeLUL").html();var vkur=value.kurs.toLowerCase();var skur=$s.find(".fachLUL").html();skur=typeof skur!=="undefined"?skur.toLowerCase():skur;var co="";if(tsie=="Vertretung")co="blue";else if(tsie=="Entfall")co="red";else co="green";if(vst==sst&&vkur==skur){$s.find(".raumLUL").html(value.nraum);$s.css("color",co)}})})});s=$s.wrap("<p/>").parent().html();if(typeof s==="undefined")return;s=s.replace("undefined","?");s=s.replace("null","");$(obj).append(s)});var headtab=$("<h3>Info</h3>\n"+"<table class='hi'>\n"+'    <tbody class="headerTab">\n'+"        \n"+"    </tbody>\n"+"</table>");cInfo.forEach(function(value,i){if(cVertretung[i][0].ctnd[0].date!==d)return;if(value===[]||value[0]===undefined||value[1]===undefined)return;headtab.find(".headerTab").append("<tr><td>"+value[0]+"</td><td>"+value[1]+"</td></tr>")});if($(headtab).find("tbody").children().length!==0)ret.append($(headtab));var vertInfo=$("<h3>"+Gstufe+"</h3>\n"+"<table class='hi'>\n"+"   <tbody>\n"+"       \n"+"   </tbody>\n"+"</table>");console.log(cVertretung);cVertretung.forEach(function(value,j){value.forEach(function(value2,j2){if(value2.klasse.indexOf(Gstufe)!==-1){value2.ctnd.forEach(function(value3){var ty=value3.type;if(ty==="Vertretung")ty="Vert";if(ty==="Raum-Vtr.")ty="Raum";if(ty==="Entfall")ty="Entf";if(ty==="Sondereins.")ty="Sonder";var inf=value3.info;var dict=[["selbständiges arbeiten","Selbst. Arb."],["selbstständiges arbeiten","Selbst. Arb."],["aufgaben","Aufg."],["raumwechsel","RaumW."]];dict.forEach(function(mmm){inf=inf.replace(new RegExp(mmm[0],"ig"),mmm[1])});var toAppend="<tr><td><b>"+value3.stunde+"</b></td><td>"+value3.kurs+"</td><td>"+ty+"</td><td>"+value3.nraum+"</td><td>"+inf+"</td></tr>";if(value3.date===d)vertInfo.find("tbody").append(toAppend)})}})});if(vertInfo.find("tbody").children().length!==0)ret.append(vertInfo);ret.append("<div class='spacer'></div>");$("#inner-tag-wrapper").append(ret)});$("#anzeigen-wrapper").removeClass("hidden")}