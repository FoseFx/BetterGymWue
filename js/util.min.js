function splitter(e,t){for(var n=[];e.length>t;){var a=e.substring(0,t).lastIndexOf(" ");a=a<=0?t:a,n.push(e.substring(0,a));var r=e.indexOf(" ",a)+1;(r<a||r>a+t)&&(r=a),e=e.substring(r)}return n.push(e),n}function stopSpinner(){$("#spinner").css("opacity","0"),setTimeout(function(){$("#spinner").css("display","none"),$("#page-wraper").css("display","block"),setTimeout(function(){$("#page-wraper").css("opacity","1")},10)},200)}function startSpinner(){$("#page-wraper").css("opacity","0"),setTimeout(function(){$("#page-wraper").css("display","none"),$("#spinner").css("display","flex"),setTimeout(function(){$("#spinner").css("opacity","1")},10)},200)}function showAGB(){$("#terms").css("display","flex")}function checkLoginCookie(){var e=checkCookie("key");null!==e?login(e,1):moveInLogin()}function checkStufeCookie(){startSpinner();var e=checkCookie("stufe");null!==e?(Gstufe=e,GStufeid=checkCookie("stufeid"),accessStufe()):(moveInStufe(),getStufen()),stopSpinner(),$(".nointeract").removeClass("nointeract")}function moveInLogin(){setTimeout(function(){$("#login-wrapper").css("transform","translate(-50%,-50%)")},700)}function unAuth(){$("#login-wrapper").css("box-shadow","0px 0px 12px 0px rgba(255,36,36,1)"),$("#page-wraper").addClass("shake shake-constant"),setTimeout(function(){$("#page-wraper").removeClass("shake shake-constant"),$("#psw").val("")},200)}function moveInStufe(){$("#stufe-wrapper").removeClass("hidden").css("transform","translate(-50%, -50%)")}function Auth(e){document.cookie="key="+e+";expires=Fri, 31 Dec 9999 23:59:59 GMT",Gkey=e,$("#login-wrapper").css("opacity","0"),setTimeout(function(){$("#login-wrapper").css("display","none"),checkStufeCookie()},500)}function checkCookie(e){var t=null;return document.cookie.split(";").forEach(function(n){var a=n.split("=");a[0].replace(/\s/g,"")===e&&(t=a[1])}),t}function moveOutStufe(){$("#stufe-wrapper").css("transform","translate(-1000%, -50%)"),setTimeout(function(){$("#login-wrapper").hide()},500)}function getWeekOfYear(e){return e.getWeek()}function to5erString(e){for(var t=e;5!==t.length;)t="0"+t;return t}$(document).ready(function(){$("#leftarrow").css("opacity","0");var e=!1;document.cookie.split(";").forEach(function(t){"a=true"==t&&(e=!0)}),stopSpinner(),e||showAGB(),e&&checkLoginCookie();var t=checkCookie("key");null!==t&&(Gkey=t);var n=JSON.parse(checkCookie("tt"));null!==n&&(GTimeTable=n);var a=checkCookie("kl");if(null!==a){for(var r="",s=0;s<a;s++)r+=checkCookie("k"+s);GMyKurse=JSON.parse(r).a}}),Date.prototype.getWeek=function(){var e=new Date(this.valueOf()),t=(this.getDay()+6)%7;e.setDate(e.getDate()-t+3);var n=e.valueOf();return e.setMonth(0,1),4!=e.getDay()&&e.setMonth(0,1+(4-e.getDay()+7)%7),1+Math.ceil((n-e)/6048e5)};var Scrawled=0,Scbase=GURL+"Schueler/",Scmid="f1/",Scurl="subst_001.htm",Scfiles=[],Scbodys=[],Scbody1=null,Scbody2=null,allowed=!0;function scrawl(){if(allowed){allowed=!1,startSpinner();var e=Scbase+Scmid+Scurl;$.ajax({cache:!1,contentType:"Content-type: text/html; charset=iso-8859-1",url:e,beforeSend:function(e){e.setRequestHeader("Authorization","Basic "+Gkey),e.overrideMimeType("text/html;charset=iso-8859-1")},success:function(e){Scfiles.push(Scurl),Scurl=e.split('<meta http-equiv="refresh" content="10; URL=')[1].split('">')[0],Scbodys.push(e.split('<body bgcolor="#F0F0F0">')[1].split("</body>")[0]),e=null,allowed=!0,-1===Scfiles.indexOf(Scurl)?scrawl():evaScrawl()}})}}function evaScrawl(){if(1===++Scrawled&&(Scbody1=Scbodys,Scmid="f2/",Scurl="subst_001.htm",Scfiles=[],Scbodys=[],scrawl()),2===Scrawled){Scbody2=Scbodys;var e,t=[],n=[];Scbody1.forEach(function(e){var a=(e=$(e)).find("td.info");if(0===a.length&&(a=null),null!==a){var r=[];a.each(function(){r.push($(this).html())}),r.forEach(function(e){-1===t.indexOf(e)&&t.push(e)})}var s=[];$(e.find("table.mon_list")[0]).children("tbody").children().each(function(e){if(0!==e)if(1===$(this).children().length)s.push({klasse:$(this).children(".inline_header").html(),ctnd:[]});else{var t=$(this).children(),n=[,$(t[1]).html()];-1!==n[1].indexOf(" - ")&&(n=n[1].split(" - "),s[s.length-1].ctnd.push({date:$(t[0]).html(),stunde:n[0],kurs:$(t[2]).html(),type:$(t[3]).children("b").html(),nraum:$(t[5]).html(),info:$(t[6]).html()})),s[s.length-1].ctnd.push({date:$(t[0]).html(),stunde:n[1],kurs:$(t[2]).html(),type:$(t[3]).children("b").html(),nraum:$(t[5]).html(),info:$(t[6]).html()})}}),s.forEach(function(e){var t=!1;n.forEach(function(n){n.klasse===e.klasse&&(t=!0,e.ctnd.forEach(function(e){n.ctnd.push(e)}))}),t||n.push(e)})}),t=[[],t],n=[[],n],Scbody2.forEach(function(e){var a=(e=$(e)).find("td.info");if(0===a.length&&(a=null),null!==a){var r=[];a.each(function(){r.push($(this).html())}),r.forEach(function(e){-1===t[0].indexOf(e)&&t[0].push(e)})}var s=[];$(e.find("table.mon_list")[0]).children("tbody").children().each(function(e){if(0!==e)if(1===$(this).children().length)s.push({klasse:$(this).children(".inline_header").html(),ctnd:[]});else{var t=$(this).children(),n=[,$(t[1]).html()];-1!==n[1].indexOf(" - ")&&(n=n[1].split(" - "),s[s.length-1].ctnd.push({date:$(t[0]).html(),stunde:n[0],kurs:$(t[2]).html(),type:$(t[3]).children("b").html(),nraum:$(t[5]).html(),info:$(t[6]).html()})),s[s.length-1].ctnd.push({date:$(t[0]).html(),stunde:n[1],kurs:$(t[2]).html(),type:$(t[3]).children("b").html(),nraum:$(t[5]).html(),info:$(t[6]).html()})}}),s.forEach(function(e){var t=!1;n[0].forEach(function(n){n.klasse===e.klasse&&(t=!0,e.ctnd.forEach(function(e){n.ctnd.push(e)}))}),t||n[0].push(e)})}),n.reverse(),t.reverse(),console.log(n),console.log(t),stopSpinner(),n.forEach(function(a,r){var s=new Date;for(1===r&&s.setDate(s.getDate()+1);0===s.getDay()||6===s.getDay();)s.setDate(s.getDate()+1);0===r&&(e=s),1===r&&e.getDate()==s.getDate()&&s.setDate(s.getDate()+1);var c=s.getDate()+"."+(s.getMonth()+1)+".";console.log(s);var o='<div class="tag">\n                    <h1>'+["So","Mo","Di","Mi","Do","Fr","Sa"][s.getDay()]+" "+c+"</h1>\n                    <hr>\n                    <table>\n                        <tbody class='lul'>\n                            <tr><td><b>Std.</b></td><td><b>Fach</b></td><td><b>Raum</b></td><td><b>Lehrer</b></td></td><td></td></tr>\n                        </tbody>\n                    </table>\n                </div>",i=$(o),l=$(i).find("tbody.lul")[0],u=s.getWeek()%2==0?0:1,d=[];n.forEach(function(e){e.forEach(function(e){-1!==e.klasse.indexOf(Gstufe)&&e.ctnd.forEach(function(e){e.date===c&&(GMyKurse.forEach(function(t){t.fach!==e.kurs&&"&nbsp;"!==e.kurs||d.push(e)}),GTimeTable[u].days.forEach(function(t){t.forEach(function(t){t!=={}&&null!==t&&"klasse"===t.type&&t.fach===e.kurs&&d.push(e)})}))})})}),console.log(d),GTimeTable[u].days[s.getDay()-1].forEach(function(e,t){var a="";e==={}?a="<tr><td colspan='5'>Pause</td></tr>":"klasse"===e.type?a="<tr><td class='stundeLUL'>"+(t+1)+"</td><td class='fachLUL'>"+e.fach+"</td><td class='raumLUL'>"+e.raum+"</td><td class='lehrerLUL'>"+e.lehrer+"</td></tr>":"kurs"===e.type&&GMyKurse.forEach(function(n){if(n.title===e.fach){var r=null;e.raeume.forEach(function(e){e.kurs===n.fach&&(r=e.raum)}),r=null===r?"- - -":r,a="<tr><td class='stundeLUL'>"+(t+1)+"</td><td class='fachLUL'>"+n.fach+"</td><td class='raumLUL'>"+r+"</td><td class='lehrerLUL'>"+n.lehrer+"</td></tr>"}});var r=$(a);n.forEach(function(e){void 0!==a&&0!==e.length&&e[0].ctnd[0].date===c&&e.forEach(function(e){-1!==e.klasse.indexOf(Gstufe)&&e.ctnd.forEach(function(e){var t=e.type,n=e.stunde,a=r.find(".stundeLUL").html(),s=e.kurs.toLowerCase(),c=r.find(".fachLUL").html();c=void 0!==c?c.toLowerCase():c;var o="";o="Vertretung"==t?"blue":"Entfall"==t?"red":"green",n==a&&s==c&&(r.find(".raumLUL").html(e.nraum),r.css("color",o))})})}),void 0!==(a=r.wrap("<p/>").parent().html())&&(a=(a=a.replace("undefined","?")).replace("null",""),$(l).append(a))});var h=$("<h3>Info</h3>\n<table class='hi'>\n    <tbody class=\"headerTab\">\n        \n    </tbody>\n</table>");t.forEach(function(e,t){n[t][0].ctnd[0].date===c&&e!==[]&&void 0!==e[0]&&void 0!==e[1]&&h.find(".headerTab").append("<tr><td>"+e[0]+"</td><td>"+e[1]+"</td></tr>")}),0!==$(h).find("tbody").children().length&&i.append($(h));var f=$("<h3>"+Gstufe+"</h3>\n<table class='hi'>\n   <tbody>\n       \n   </tbody>\n</table>");console.log(n),n.forEach(function(e,t){e.forEach(function(e,t){-1!==e.klasse.indexOf(Gstufe)&&e.ctnd.forEach(function(e){var t=e.type;"Vertretung"===t&&(t="Vert"),"Raum-Vtr."===t&&(t="Raum"),"Entfall"===t&&(t="Entf"),"Sondereins."===t&&(t="Sonder");var n=e.info;[["selbständiges arbeiten","Selbst. Arb."],["selbstständiges arbeiten","Selbst. Arb."],["aufgaben","Aufg."],["raumwechsel","RaumW."]].forEach(function(e){n=n.replace(new RegExp(e[0],"ig"),e[1])});var a="<tr><td><b>"+e.stunde+"</b></td><td>"+e.kurs+"</td><td>"+t+"</td><td>"+e.nraum+"</td><td>"+n+"</td></tr>";e.date===c&&f.find("tbody").append(a)})})}),0!==f.find("tbody").children().length&&i.append(f),i.append("<div class='spacer'></div>"),$("#inner-tag-wrapper").append(i)}),$("#anzeigen-wrapper").removeClass("hidden")}}